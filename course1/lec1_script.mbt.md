# 现代编程思想：课程概览与程序设计

大家好，欢迎来到由IDEA研究院基础软件中心为大家带来的现代编程思想公开课。今天是第一节课，将为大家介绍课程概览，并介绍程序设计的基本流程。

## 课程介绍

### 致谢

这门课程是参考了[宾夕法尼亚大学CIS1200课程](https://www.seas.upenn.edu/~cis120/current/)设计的，在此表达敬意。

### 什么是现代编程思想课

这门公开课是一门程序设计课。我们的课程不设门槛，面向所有的编程爱好者，无论是否有编程经验。我们将尽全力将内容讲解得清晰易懂。

这门课程将传授大家实用的技巧，包括编写较大型程序（大约一万行代码级别）的能力，独立分析解决问题的能力，以及通过测试驱动开发与设计的能力。为了支撑这些能力，我们也希望能给大家打下坚实知识基础，这包括常见的数据结构（数据的存储、组织方式）与算法（对问题解法的描述）以及多种编程范式（函数式、命令式、面向对象）。我们将关注如何写出模块化的、可组合的程序。在我们看来，现代编程就是数据结构+算法+模块化编程。

### 课程工具

这门公开课将使用月兔MoonBit这门编程语言，由基础软件中心开发。这是一门现代的编程语言，博采众长，吸收了诸多编程语言开发使用的经验和教训，并对各种特性进行权衡考量。其次，这是一门静态类型的语言，意味着编译器将在编译时进行大量检查，最大可能减少运行时的错误，可以引导新手写出正确的程序。最后，这是一门多范式的语言，同时支持函数式、命令式、面向对象等编程范式，适合教学。

同时，月兔Moonbit语法轻量，简洁易懂，十分容易上手。基础软件中心在语言本身之外还开发了众多开发者工具，支持纯浏览器开发环境、云原生开发环境以及本地集成开发环境。无需额外安装软件，即可尝试体验。依赖云原生开发环境，也可以在浏览器中进行大型项目的开发。开发环境的准备将在另外的课程中进行介绍。

### 课程概览

|课程|主题|课程|主题|
|----|----|----|----|
| 1 | 课程介绍与程序设计| 10 | 接口：集合与表|
| 2 | 面向值编程 | 11 |Optional / 结构体 / 单位元, Sequencing, 命令 |
| 3 | 函数, 列表与递归 | 12 | 可变状态, Aliasing与可变数据结构 |
| 4 | 列表, 元组, 嵌套模式 | 13 | 抽象堆栈结构机器 |
| 5 | 数据类型与树 | 14 | 可变队列 |
| 6 | 树与二分查找 | 15 | 迭代与尾递归 |
| 7 | 二叉搜索树的插入与删除 | 16 | 闭包与对象 |
| 8 | 泛型与高阶函数 | 17 | 案例：句法分析器与程序解释器 |
| 9 | 高阶函数：Transform与Fold | 18 | 案例：自动积分与小游戏 |

我们将从较为简单的函数式编程开始，学习基础数据结构，如列表、树，以及相关算法。之后我们将会涉及函数式编程的进阶内容，如高阶函数、接口等。然后我们将进入命令式编程的学习，开始接触可变数据。我们将以面向对象编程思想结束我们的学习。课程的最后，我们还将带来一些案例，使用月兔开发较为复杂的程序。

课程的资料，包括视频、讲义与代码，均在互联网上公开。大家可以根据自己的进度自行学习。我们将会设置[课程论坛](https://taolun.moonbitlang.cn)，为大家答疑解惑，也欢迎大家在论坛上对我们的课程内容进行反馈，指出我们的不足。

## 程序设计

程序设计是将非正式的规范（通常用具有二义性的自然语言描述）转化为可运行代码的过程。将规范转化为代码不仅仅意味着开发出我们所期望获得的可以运行的程序，也意味着转化对于软件的规范要求。我们在这里介绍的流程基于测试驱动开发的理念。测试驱动开发，即是将对于软件的要求转化为实际的测试代码，并在软件开发周期中反复对软件进行测试以保证符合软件的要求。

### 基础设计流程

这个过程大致可以分为四步：
- 第一步：理解问题。我们需要理解这个问题涉及哪些概念，这些概念之间存在怎样的联系。
- 第二步：定义接口。我们需要定义程序应当如何与环境互动，例如如何与其他程序互动（函数接口）、如何与人互动（输入输出）等。
- 第三步：写测试案例。我们需要定义程序对于特定输入应当有怎样的输出。对于我们所期待的输入，程序应当如何表现，对于非正常输入，程序应当如何表现。举个广为人知的例子，在一个酒吧中点一杯啤酒，应当获得一杯啤酒；点一杯鸡尾酒，也应当获得一杯鸡尾酒而不是啤酒。而如果在酒吧中点了一碗炒饭，又该如何呢？
- 第四步：实现规定的行为。到了这一步，理应开始实现我们的程序了。但有的时候，问题依然非常庞大复杂，我们需要将问题分解为规模更小、更加简单的子问题，对各个问题进行解决。在这个过程中，我们同样要对各个子问题重复以上流程。

### 一个设计例题

让我们来看一道例题，来自[力扣第1518题](https://leetcode.cn/problems/water-bottles/)。

> 超市正在促销，你可以用 `num_exchange` 个空水瓶从超市兑换一瓶水。最开始，你一共购入了 `num_bottles` 瓶水。
> 如果喝掉了水瓶中的水，那么水瓶就会变成空的。
> 给你两个整数 `num_bottles` 和 `num_exchange` ，返回你**最多**可以喝到多少瓶水。

#### 步骤一：理解问题

在问题中，我们涉及到了两个概念：当前喝过的瓶数、当前拥有的水瓶数。那么这两者之间是怎样的关系呢？

- 我们一开始拥有的水瓶数为`num_bottles`。
- 如果我们拥有的水瓶数大于等于`num_exchange`，即换购所需空瓶数，我们可以喝掉`num_exchange`瓶水。此时喝过的水瓶数增加了`num_exchange`，拥有的水瓶数减少了`num_exchange`。我们可以用这些空瓶子换来一杯水，即拥有的水瓶数增加了一。此时我们仍拥有装满水的瓶子，可以反复进行操作。
- 如果我们拥有的水瓶数小于`num_exchange`，我们只能将拥有的水瓶全部喝空。此时喝过的水瓶数增加我们原有的水瓶数。此时我们只有空瓶子，不能继续喝水，也不能继续换瓶子。

我们的程序要取得的便是给定最初的水瓶数`num_bottles`以及空瓶换水瓶的条件`num_exchange`，求最多能喝多少瓶水。

#### 步骤二：定义接口

根据问题描述，我们并不需要进行输入输出的操作。我们只需要在给定两个整数：`num_bottles`和`num_exchange`的情况下返回一个代表最多喝到的瓶数的整数即可。依此，我们可以用MoonBit语言写出如下接口：

```moonbit
fn num_water_bottles_(num_bottles: Int, num_exchange: Int) -> Int {
    abort("To be done")
}
```

可以看到，我们只定义了接口，而并未给出具体实现。月兔允许我们在程序中留下未实现的部分而仍然正常通过编译。

#### 步骤三：写测试案例

写测试案例的过程也是加深对问题理解的过程。我们这里给出两个测试。大家也可以添加自己的测试。

```moonbit
test {
  assert_eq(num_water_bottles_(9, 3), 13)
  assert_eq(num_water_bottles_(15, 4), 19)
}
```

以第一组数据为例。如果我们一开始有9瓶水，喝完9瓶水后可换得3瓶水，喝完3瓶水后可换得1瓶水，喝完1瓶水后不可再换，因此我们总共可以喝`9 + 3 + 1 = 13`瓶水。

#### 步骤四：实现程序

到了这一步，我们可以实现我们的程序，并且可以通过运行我们的测试案例来进行检验。我们在这里给出一个可能的实现，它直接模拟了我们对问题的分析。

```moonbit
fn num_water_bottles(num_bottles: Int, num_exchange: Int) -> Int {
  fn consume(num_bottles, num_drunk) {
    if num_bottles >= num_exchange {
      let num_bottles = num_bottles - num_exchange + 1
      let num_drunk = num_drunk + num_exchange
      consume(num_bottles, num_drunk)
    } else {
      num_bottles + num_drunk
    }
  }
  consume(num_bottles, 0)
}

test {
  assert_eq(num_water_bottles(9, 3), 13)
  assert_eq(num_water_bottles(15, 4), 19)
}
```

我们可以运行它。没有输出代表我们的程序如测试案例所预期的那样执行了。大家也可以尝试修改其中的大于等于号，改为大于号并再次运行。此时我们将会观察到错误。

### 总结

我们希望推动大家采取迭代的、测试驱动的设计流程：
1. 理解问题
2. 定义接口
3. 定义测试案例
4. 实现期望的行为（对问题进行进一步的分解）

现代的软件规模庞大。测试驱动开发可以通过定义测试来更好地指导我们的开发。在开发流程中应当尽早定义测试案例，之后运行测试即可尽早发现和纠正软件中可能存在的错误，也可保证不断添加的新功能不会破坏已有的功能。

## 课程总结

以上便是今天第一节课的全部内容，感谢大家观看。

## 课后小练习

课程中给出的案例代码只实现了对于理想的输入的计算。对于非正常输入会出现错误。你能找到这样的非正常输入吗？（提示：在月兔中，Int代表的整数范围为-2,147,483,648到+2,147,483,647）